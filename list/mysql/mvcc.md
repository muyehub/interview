# mvcc 多版本并发控制

### 隔离级别
mysql 有四种隔离级别，按照严格程度分别是：读未提交、读已提交、可重复读、串行化。

- 读未提交：事务可以读取其他事务未提交的数据。
- 读已提交：事务只能读取其他事务已提交的数据。
- 可重复读：事务在开始时读取快照，之后的查询都基于这个快照。
- 串行化：事务完全隔离，类似于单线程执行。

这四种隔离级别中只有读已提交和可重复读用到了 mvcc，读未提交是直接读取数据页，串行化是通过加表锁来实现的。

mvcc 为了平衡事务的并发性和一致性，采用了快照读的无锁方式。他的快照的底层数据结构是版本链的结构，本质上是一种乐观锁，给当前的事务设置一个版本号。

### 乐观锁与悲观锁

从名字可以看出来，乐观锁对于数据的修改是乐观的，认为数据不会发生冲突，所以在修改数据时不加锁，而是通过版本号来判断数据是否被其他事务修改过。

悲观锁则是认为数据会发生冲突，所以在修改数据时加锁，直到事务提交或回滚才释放锁。

### 推荐视频

[MySQL MVCC原理](https://www.bilibili.com/video/BV1Hr421p7EK/?spm_id_from=333.337.search-card.all.click&vd_source=c4ded1c149e9e44dc22e4b5626210fc7)
