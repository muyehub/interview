# 内存分配机制

Go 里面的内存是自主管理的，不需要程序员干预，不用每次调用系统函数去操作。这样可以自主的实现更好的内存设计模式，比如内存池、预分配等等。

### 设计思想

* 内存分配算法采用 Google 的 TCMalloc 算法，每个线程都会自行维护一个独立的内存池，进行内存分配时优先从该内存池中分配，当内存池不足时才会加锁向全局内存池申请，减少系统调用并且避免不同线程对全局内存池的竞争
* 把内存切分的非常的细小，分为多级管理，以降低锁的粒度
* 回收对象内存时，并没有将其真正释放掉，只是放回预先分配的大块内存中，以便复用。只有内存限制过多的时候，才会尝试归还部分内存给操作系统，降低整体开销

### 分配组件
Go 的内存管理组件有：mspan、mcache、mcentral 和 mheap

* mspan：表示一块连续的内存区域，包含了一个或多个 mspan 对象。mspan 主要用于管理小对象的内存分配和回收。
* mcache：表示一个线程的本地缓存，用于存储小对象的分配和回收。每个线程都有自己的 mcache，避免了多线程之间的竞争。
* mcentral：表示一个中央缓存，用于存储大对象的分配和回收。mcentral 主要用于管理大对象的内存分配和回收。
* mheap：表示整个堆的内存区域，用于管理所有对象的分配和回收。mheap 主要用于管理整个堆的内存分配和回收。

